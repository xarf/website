{
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"$id": "https://xarf.org/schemas/v4/types/content-malware.json",
	"title": "XARF v4 Content - Malware Type Schema",
	"description": "Schema for malware hosting and distribution",
	"allOf": [
		{
			"$ref": "./content-base.json"
		},
		{
			"type": "object",
			"properties": {
				"type": {
					"const": "malware"
				},
				"malware_family": {
					"type": "string",
					"description": "Known malware family name",
					"examples": [
						"Emotet",
						"TrickBot",
						"Qakbot",
						"Cobalt Strike"
					]
				},
				"malware_type": {
					"type": "string",
					"enum": [
						"trojan",
						"ransomware",
						"dropper",
						"loader",
						"backdoor",
						"rootkit",
						"infostealer",
						"banking_trojan",
						"cryptominer",
						"adware",
						"spyware",
						"worm",
						"bot",
						"rat",
						"other"
					],
					"description": "Classification of the malware"
				},
				"file_hashes": {
					"type": "object",
					"properties": {
						"md5": {
							"type": "string",
							"pattern": "^[a-fA-F0-9]{32}$"
						},
						"sha1": {
							"type": "string",
							"pattern": "^[a-fA-F0-9]{40}$"
						},
						"sha256": {
							"type": "string",
							"pattern": "^[a-fA-F0-9]{64}$"
						},
						"ssdeep": {
							"type": "string"
						}
					},
					"description": "Hash values of the malware file"
				},
				"file_metadata": {
					"type": "object",
					"properties": {
						"filename": {
							"type": "string"
						},
						"file_size": {
							"type": "integer",
							"minimum": 0
						},
						"file_type": {
							"type": "string",
							"examples": [
								"PE32 executable",
								"PDF document",
								"Microsoft Word document",
								"ZIP archive"
							]
						},
						"mime_type": {
							"type": "string"
						}
					},
					"description": "Metadata about the malware file"
				},
				"distribution_method": {
					"type": "string",
					"enum": [
						"direct_download",
						"drive_by_download",
						"email_attachment",
						"malvertising",
						"exploit_kit",
						"watering_hole",
						"supply_chain",
						"social_engineering",
						"other"
					],
					"description": "How the malware is being distributed"
				},
				"c2_servers": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"address": {
								"type": "string",
								"description": "IP or domain of C2 server"
							},
							"port": {
								"type": "integer",
								"minimum": 1,
								"maximum": 65535
							},
							"protocol": {
								"type": "string",
								"enum": ["http", "https", "tcp", "udp", "dns", "other"]
							}
						}
					},
					"description": "Command and control servers if known"
				},
				"sandbox_analysis": {
					"type": "object",
					"properties": {
						"sandbox_name": {
							"type": "string",
							"examples": ["VirusTotal", "Hybrid Analysis", "Joe Sandbox"]
						},
						"analysis_url": {
							"type": "string",
							"format": "uri"
						},
						"verdict": {
							"type": "string",
							"enum": ["malicious", "suspicious", "clean", "unknown"]
						},
						"score": {
							"type": "number",
							"minimum": 0,
							"maximum": 100
						}
					},
					"description": "Results from automated malware analysis"
				},
				"exploit_cve": {
					"type": "array",
					"items": {
						"type": "string",
						"pattern": "^CVE-\\d{4}-\\d{4,}$"
					},
					"description": "CVEs exploited by this malware"
				},
				"persistence_mechanism": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"registry",
							"scheduled_task",
							"service",
							"startup_folder",
							"dll_hijacking",
							"wmi",
							"other"
						]
					},
					"description": "How the malware maintains persistence"
				},
				"targeted_platforms": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"windows",
							"linux",
							"macos",
							"android",
							"ios",
							"multi_platform"
						]
					},
					"description": "Operating systems targeted by the malware"
				}
			}
		}
	],
	"examples": [
		{
			"xarf_version": "4.0.0",
			"report_id": "e5f6a7b8-c9d0-1234-efab-cdef01234567",
			"timestamp": "2025-01-15T12:45:00Z",
			"reporter": {
				"org": "Malware Analysis Lab",
				"contact": "alerts@malwarelab.example",
				"type": "automated"
			},
			"source_identifier": "198.51.100.123",
			"class": "content",
			"type": "malware",
			"url": "https://malicious-downloads.example.com/invoice.exe",
			"malware_family": "Emotet",
			"malware_type": "trojan",
			"file_hashes": {
				"sha256": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
			},
			"distribution_method": "email_attachment",
			"evidence": [
				{
					"content_type": "application/octet-stream",
					"description": "Malware sample",
					"payload": "base64_encoded_malware"
				}
			]
		}
	]
}
